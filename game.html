<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Pirate's Harvest</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Google Font (Bangers for a playful, pirate/anime feel) -->
    <link href="https://fonts.googleapis.com/css2?family=Bangers&family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Custom styles for the pirate theme and interactive background */
        :root {
            --primary-yellow: #ffc107; /* Gold/Treasure color */
            --secondary-blue: #1e88e5; /* Sea/Sky color */
            --tertiary-green: #4caf50; /* Crop/Farm color */
            --background-dark: #004d40; /* Deep Ocean/Ship deck */
            --text-color: #333;
        }

        body {
            font-family: 'Bangers', cursive, 'Inter', sans-serif;
            background-color: var(--background-dark);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: var(--text-color);
            position: relative;
            overflow: hidden;
        }

        /* --- Interactive Background: Stylized Ship Deck/Sea --- */
        .game-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            background: linear-gradient(180deg, var(--secondary-blue) 0%, #0d47a1 100%);
            opacity: 0.8;
        }

        /* Animated Clouds */
        .cloud {
            position: absolute;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 50%;
            animation: moveClouds 30s linear infinite;
        }
        .cloud:nth-child(1) { width: 150px; height: 50px; top: 10%; left: 0%; animation-delay: 0s; }
        .cloud:nth-child(2) { width: 100px; height: 40px; top: 20%; left: 30%; animation-delay: -10s; }
        .cloud:nth-child(3) { width: 200px; height: 60px; top: 5%; left: 60%; animation-delay: -20s; }

        @keyframes moveClouds {
            0% { transform: translateX(-100vw); }
            100% { transform: translateX(200vw); }
        }

        /* Animated Waves/Sea Ripple */
        .wave {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 50px;
            background: rgba(0, 0, 0, 0.1);
            animation: ripple 5s ease-in-out infinite alternate;
        }

        @keyframes ripple {
            0% { transform: translateY(0); }
            100% { transform: translateY(-5px); }
        }

        /* --- Game Card & UI --- */
        .game-card {
            z-index: 10;
            max-width: 95%;
            width: 500px;
            background-color: #fff;
            border: 8px solid var(--primary-yellow);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
        }

        .level-header {
            color: var(--background-dark);
            text-shadow: 2px 2px 0 var(--primary-yellow);
            font-size: 2.5rem;
            line-height: 1;
            margin-bottom: 0.5rem;
        }

        .puzzle-goal {
            background-color: #fce883;
            border: 2px dashed #e69100;
            padding: 0.5rem;
            margin-bottom: 1rem;
            border-radius: 8px;
            color: #7a4800;
            font-size: 1.2rem;
            font-family: 'Inter', sans-serif;
            font-weight: bold;
        }

        /* Grid */
        #gameGrid {
            display: grid;
            gap: 4px;
            margin: 1rem auto;
            border: 4px solid var(--tertiary-green);
            background-color: #8bc34a;
            padding: 4px;
            border-radius: 8px;
        }

        .grid-cell {
            background-color: #cddc39; /* Soil color */
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2.5rem;
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.1s;
            border: 2px solid #558b2f;
            border-radius: 4px;
        }

        .grid-cell:hover {
            transform: scale(1.05);
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        }

        /* Custom Button Style (Straw Hat / Pirate Flag) */
        .pirate-button {
            font-family: 'Bangers', cursive;
            background-color: var(--primary-yellow);
            color: var(--background-dark);
            border: 4px solid #e69100;
            text-shadow: 1px 1px 0 #fff;
            padding: 0.5rem 1.5rem;
            border-radius: 50px;
            box-shadow: 0 4px 0 #e69100;
            transition: all 0.1s;
        }
        .pirate-button:hover {
            background-color: #ffda6a;
            box-shadow: 0 2px 0 #e69100;
            transform: translateY(2px);
        }
        .pirate-button:active {
            box-shadow: none;
            transform: translateY(4px);
        }

        /* Message Box */
        #messageBox {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 50;
            display: none;
            justify-content: center;
            align-items: center;
        }
        .message-content {
            background: #fff;
            border: 10px solid #ff0000; /* For dramatic win/loss */
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            max-width: 400px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.8);
            transform: scale(0.9);
            animation: popIn 0.3s forwards;
        }
        @keyframes popIn {
            to { transform: scale(1); }
        }

        .crop-selector {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .crop-button {
            font-size: 2rem;
            padding: 0.5rem;
            border-radius: 8px;
            border: 3px solid transparent;
            cursor: pointer;
            transition: all 0.2s;
            background-color: #eee;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .crop-button.selected {
            border-color: var(--secondary-blue);
            transform: scale(1.1);
            background-color: #fff;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>
<body class="p-4">

    <!-- Interactive Background Elements -->
    <div class="game-background">
        <div class="cloud"></div>
        <div class="cloud"></div>
        <div class="cloud"></div>
        <div class="wave"></div>
    </div>

    <!-- Game Card -->
    <div class="game-card">
        <h1 class="level-header" id="levelTitle">Level 1: The First Patch</h1>

        <p class="puzzle-goal" id="goalText">
            Plant the required ratio of crops.
        </p>

        <!-- Crop Selector -->
        <div class="crop-selector">
            <button id="cropA" data-crop="ðŸ¥”" class="crop-button selected">ðŸ¥” Treasure Melon</button>
            <button id="cropB" data-crop="ðŸ¥•" class="crop-button">ðŸ¥• Seaweed Root</button>
        </div>

        <!-- Game Grid -->
        <div id="gameGrid">
            <!-- Grid cells will be injected by JavaScript -->
        </div>

        <button id="checkButton" class="pirate-button mt-4">Check Harvest!</button>
    </div>

    <!-- Message Box (Modal) -->
    <div id="messageBox" class="hidden">
        <div class="message-content bg-white p-6 rounded-xl border-4 shadow-2xl">
            <h2 id="messageTitle" class="text-3xl font-bold mb-3" style="font-family: 'Bangers', cursive; color: #ff0000; text-shadow: 1px 1px 0 #fff;"></h2>
            <p id="messageBody" class="text-gray-700 mb-6 font-medium" style="font-family: 'Inter', sans-serif;"></p>
            <button id="messageButton" class="pirate-button"></button>
        </div>
    </div>

    <script>
        // Game State and Constants
        const state = {
            currentLevel: 1,
            selectedCrop: 'ðŸ¥”', // ðŸ¥” (Treasure Melon) or ðŸ¥• (Seaweed Root)
            grid: [], // 1D array representing the planted crops
            gridSize: 3,
            totalCells: 9,
            targetRatio: { A: 0, B: 0 } // Target count for Crop A and Crop B
        };

        const CROPS = {
            A: { symbol: 'ðŸ¥”', name: 'Treasure Melon' },
            B: { symbol: 'ðŸ¥•', name: 'Seaweed Root' }
        };

        const ELEMENTS = {
            levelTitle: document.getElementById('levelTitle'),
            goalText: document.getElementById('goalText'),
            gameGrid: document.getElementById('gameGrid'),
            checkButton: document.getElementById('checkButton'),
            cropAButton: document.getElementById('cropA'),
            cropBButton: document.getElementById('cropB'),
            messageBox: document.getElementById('messageBox'),
            messageContent: document.querySelector('#messageBox .message-content'),
            messageTitle: document.getElementById('messageTitle'),
            messageBody: document.getElementById('messageBody'),
            messageButton: document.getElementById('messageButton'),
        };

        // --- Core Game Logic Functions ---

        /**
         * Determines the grid size and target ratio based on the current level.
         */
        function getLevelConfig(level) {
            let size, ratioA;

            if (level <= 15) {
                size = 3; // 3x3 = 9 cells
                // Simple ratios
                if (level % 3 === 1) ratioA = 4; // 4:5
                else if (level % 3 === 2) ratioA = 5; // 5:4
                else ratioA = 3; // 3:6
            } else if (level <= 35) {
                size = 4; // 4x4 = 16 cells
                // Medium complexity ratios
                if (level % 4 === 1) ratioA = 6; // 6:10
                else if (level % 4 === 2) ratioA = 7; // 7:9
                else if (level % 4 === 3) ratioA = 5; // 5:11
                else ratioA = 8; // 8:8
            } else if (level < 50) {
                size = 5; // 5x5 = 25 cells
                // Complex ratios
                if (level % 3 === 1) ratioA = 10; // 10:15
                else if (level % 3 === 2) ratioA = 12; // 12:13
                else ratioA = 15; // 15:10
            } else { // Level 50: Final Boss Puzzle
                size = 6; // 6x6 = 36 cells
                // Unique pattern: Player must use exactly 18 of each crop.
                return { size: 6, total: 36, title: "Level 50: The GRAND LINE Harvest!", targetA: 18, targetB: 18, goal: "Plant *exactly* 18 Treasure Melons (ðŸ¥”) and 18 Seaweed Roots (ðŸ¥•) across the 36-cell field!" };
            }

            const total = size * size;
            const ratioB = total - ratioA;
            const title = `Level ${level}: The Pirate's Patch (${size}x${size})`;
            const goal = `Plant: ${ratioA}x ${CROPS.A.name} (${CROPS.A.symbol}) AND ${ratioB}x ${CROPS.B.name} (${CROPS.B.symbol}).`;

            return { size, total, title, targetA: ratioA, targetB: ratioB, goal };
        }

        /**
         * Sets up the game state and renders the new level.
         */
        function setupLevel(level) {
            if (level > 50) {
                showModal('VICTORY!', `You have completed all 50 levels and mastered the Pirate's Harvest! You are the new King of the Farmers!`, 'Start Over', () => {
                    state.currentLevel = 1;
                    setupLevel(state.currentLevel);
                }, '#007bff');
                return;
            }

            const config = getLevelConfig(level);

            // Update State
            state.currentLevel = level;
            state.gridSize = config.size;
            state.totalCells = config.total;
            state.targetRatio.A = config.targetA;
            state.targetRatio.B = config.targetB;
            state.grid = Array(config.total).fill(''); // Reset grid

            // Update UI
            ELEMENTS.levelTitle.textContent = config.title;
            ELEMENTS.goalText.innerHTML = config.goal.replace(/\*/g, '<b>').replace(/:/g, '</b>:');
            ELEMENTS.messageBox.classList.add('hidden'); // Ensure modal is hidden
            ELEMENTS.messageContent.style.borderColor = '#ffc107';

            renderGrid();
        }

        /**
         * Renders the grid based on the current state.
         */
        function renderGrid() {
            ELEMENTS.gameGrid.innerHTML = '';
            ELEMENTS.gameGrid.style.gridTemplateColumns = `repeat(${state.gridSize}, 1fr)`;

            for (let i = 0; i < state.totalCells; i++) {
                const cell = document.createElement('div');
                cell.classList.add('grid-cell');
                cell.setAttribute('data-index', i);
                cell.style.aspectRatio = '1 / 1';
                cell.textContent = state.grid[i];
                cell.onclick = handleGridClick;
                ELEMENTS.gameGrid.appendChild(cell);
            }
        }

        /**
         * Handles the click on a grid cell to place the selected crop.
         */
        function handleGridClick(event) {
            const index = parseInt(event.target.getAttribute('data-index'));
            const cell = event.target;

            // Toggle between the selected crop and empty
            if (state.grid[index] === state.selectedCrop) {
                state.grid[index] = ''; // Remove crop
                cell.textContent = '';
            } else if (state.grid[index] === (state.selectedCrop === CROPS.A.symbol ? CROPS.B.symbol : CROPS.A.symbol)) {
                // If it's the other crop, switch to the selected one
                state.grid[index] = state.selectedCrop;
                cell.textContent = state.selectedCrop;
            } else {
                // Place the selected crop
                state.grid[index] = state.selectedCrop;
                cell.textContent = state.selectedCrop;
            }
        }

        /**
         * Checks if the player's planted grid matches the required ratio.
         */
        function checkWin() {
            const currentCounts = { A: 0, B: 0 };

            state.grid.forEach(crop => {
                if (crop === CROPS.A.symbol) currentCounts.A++;
                else if (crop === CROPS.B.symbol) currentCounts.B++;
            });

            // The remaining cells must be empty for the ratio to hold true
            const emptyCells = state.totalCells - (currentCounts.A + currentCounts.B);
            const isFullyPlanted = emptyCells === 0;

            const isWin = currentCounts.A === state.targetRatio.A && currentCounts.B === state.targetRatio.B;

            if (isWin) {
                showModal('Success! A bountiful harvest!', `You solved Level ${state.currentLevel}! The Pirate King would be proud of your farming skills. Prepare for the next challenge!`, 'Sail to Next Level', () => {
                    setupLevel(state.currentLevel + 1);
                }, '#4caf50');
            } else {
                let message = `You need ${state.targetRatio.A} ${CROPS.A.symbol} and ${state.targetRatio.B} ${CROPS.B.symbol}.`;
                message += `<br>You currently have: ${currentCounts.A} ${CROPS.A.symbol} and ${currentCounts.B} ${CROPS.B.symbol}.`;

                if (!isFullyPlanted) {
                    const requiredEmpty = state.totalCells - (state.targetRatio.A + state.targetRatio.B);
                    if (requiredEmpty > 0) {
                         message += `<br>Also, remember to leave ${requiredEmpty} cells empty, or fill the entire grid if no empty cells are required.`;
                    }
                }

                showModal('Ahoy! That\'s the wrong ratio!', message, 'Try Again!', () => {
                    // Just hide the modal, grid state is preserved
                    ELEMENTS.messageBox.classList.add('hidden');
                }, '#ff0000');
            }
        }

        /**
         * Custom modal/message box replacement for alert().
         */
        function showModal(title, body, buttonText, onConfirm, color = '#ffc107') {
            ELEMENTS.messageTitle.textContent = title;
            ELEMENTS.messageBody.innerHTML = body;
            ELEMENTS.messageButton.textContent = buttonText;
            ELEMENTS.messageContent.style.borderColor = color;

            ELEMENTS.messageButton.onclick = () => {
                onConfirm();
                ELEMENTS.messageBox.classList.add('hidden');
            };

            ELEMENTS.messageBox.classList.remove('hidden');
        }

        /**
         * Handles selecting which crop the player is planting.
         */
        function selectCrop(cropSymbol) {
            state.selectedCrop = cropSymbol;
            ELEMENTS.cropAButton.classList.remove('selected');
            ELEMENTS.cropBButton.classList.remove('selected');

            if (cropSymbol === CROPS.A.symbol) {
                ELEMENTS.cropAButton.classList.add('selected');
            } else {
                ELEMENTS.cropBButton.classList.add('selected');
            }
        }

        // --- Event Listeners and Initialization ---

        window.onload = () => {
            // Initial setup
            setupLevel(state.currentLevel);

            // Bind check button
            ELEMENTS.checkButton.onclick = checkWin;

            // Bind crop selectors
            ELEMENTS.cropAButton.onclick = () => selectCrop(CROPS.A.symbol);
            ELEMENTS.cropBButton.onclick = () => selectCrop(CROPS.B.symbol);

            // Set up initial selected state
            selectCrop(CROPS.A.symbol);
        };
    </script>
</body>
</html>